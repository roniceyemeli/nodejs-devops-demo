name: Rollback Release

on:
  workflow_dispatch:
    inputs:
      version:
        description: "Version tag to rollback to (e.g. v2.0.0)"
        required: true
        type: string

permissions:
  contents: read

jobs:
  rollback:
    name: Rollback to previous release
    runs-on: ubuntu-latest

    steps:
      # 1ï¸âƒ£ Checkout repository metadata (no code yet)
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # 2ï¸âƒ£ Verify that the requested tag exists
      - name: Verify tag exists
        run: |
          git fetch --tags
          if ! git rev-parse "refs/tags/${{ inputs.version }}" >/dev/null 2>&1; then
            echo "âŒ Tag '${{ inputs.version }}' does not exist."
            exit 1
          fi
          echo "âœ… Tag '${{ inputs.version }}' found."

      # 3ï¸âƒ£ Checkout the exact tag (FIXED PART)
      - name: Checkout selected version
        uses: actions/checkout@v4
        with:
          ref: refs/tags/${{ inputs.version }}
          fetch-depth: 0

      # 4ï¸âƒ£ Deploy rollback version
      - name: Deploy previous version
        run: |
          echo "ğŸš€ Deploying rollback version: ${{ inputs.version }}"
          # Example:
          # npm ci
          # npm run build
          # ./deploy.sh
